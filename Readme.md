# Процессы
## ДЗ Добановой Анастасии
### [Шпаргалка Linux](https://docs.google.com/spreadsheets/d/1HIwU3FUHJ81-9DYUKnv_KfqYGsFd883RWTfMGSk0qbo/edit?usp=sharing)
### Контрольные вопросы
1. Для чего предназначена команда at? Как её использовать?

Команда at позволяет передавать задания демону cron для одноразового выполнения в назначенное время. Выдавая задание, команда at сохраняет в отдельном файле как его текст, так и все текущие переменные среды, чего не делает команда crontab. По умолчанию все результаты выполнения задания направляются пользователю в виде электронного сообщения.

Как и в случае с crontab суперпользователь может контролировать, кому разрешено или запрещено выполнять команду at. 

Пользователям разрешается использовать команду at, если их регистрационные имена указаны в файле /etc/at.allow. Если этот файл не существует, проверяется файл /etc/at.deny, чтобы определить, не запрещен ли пользователю доступ к at.

Базовый формат команды at:

at [-f файл] [-l –d -m] время

– f файл – список заданий должен быть взят из указанного файла;

– l – вывод на экран списка заданий; аналог команды atq;

– d – удаление задания с указанным номером; аналог команды atrm (в некоторых системах заменяется опцией -r);

– m – выдача пользователю сообщения по электронной почте о завершении задания;

Время – определение времени выполнения задания. Допускается указание не только времени в формате часы:минуты, но и даты, а также многочисленных ключевых слов, таких как названия дней недели, месяцев, слов today (сегодня), tomorrow (завтра), now (сейчас) и др. Часто удобна запись вида now+3 hours (через 3 часа).

Ниже приведены примеры корректного указания времени при вызове команды at:

at 6.45am May 12 – 12 мая в 6:45 утра;

at 11.10pm – в 23:10;

at now+1 hour – через час;

at 9am tomorrow – завтра в 9:00 утра;

at 15:00 May 24 – 24 мая в 15:00;

at 4am+3 days – через 3 дня в 4:00 утра.

Следующую команду можно вводить с терминала:

$ at 07:30 tomorrow

at> sort <file> outfile

at><EOT>

Строка <EOT> появляется после нажатия клавиш Ctrl+D. Если необходимо с помощью команды at запустить файл сценария, то его имя необходимо указать после опции –f, например:

at 3:00pm tomorrow –f /apps/bin/db_table.sh

Для того чтобы просмотреть список запланированных заданий, используются команды at –l или atq.

В первом столбце вывода этих команд содержится идентификатор задания, за которым следуют дата и время его выполнения. В последнем столбце находится символ «a», указывающий на то, что задание получено от команды at.

Если в последнем столбце расположен символ «b», то это указывает, что задание получено от команды batch, которая планирует выполнения задания на период наименьшей загруженности системы.

Для удаления запланированного задания используется команда atrm (синоним команды at -d), имеющая следующий формат:

atrm номер_задания

2. Для чего предназначена команда batch? Как её использовать? Чем отличаются команды at и batch?

Команда batch подобна команде at, но запускается не в определенное пользователем время, а когда система сама решит, что загрузка позволяет ей запустить дополнительные процессы.

Для выполнения разовой задачи, когда средняя загрузка опускается ниже 0,8, используйте команду batch.

После ввода команды batch появляется приглашение at>. Введите команду, которая должна быть выполнена, а затем нажмите [Enter] и [Ctrl]-[D]. Вы можете указать несколько команд, нажимая клавишу [Enter] после ввода каждой команды. Когда вы наберёте все команды, нажмите [Enter] чтобы перейти на пустую строку, а затем нажмите [Ctrl]-[D]. Вы также можете ввести в этом приглашении сценарий оболочки, нажимая [Enter] в конце каждой строки сценария, и нажав [Ctrl]-[D] в пустой строке, чтобы выйти из программы. Если введён сценарий, для его исполнения используется оболочка, указанная в переменной окружения пользователя SHELL, оболочка пользователя для входа в систему или /bin/sh (в зависимости от того, какая будет найдена первой). Заданный набор команд будет выполнен, как только средняя загрузка опустится ниже 0,8.

Если заданные команды или сценарий выводит сообщения на стандартное устройство вывода, эти сообщения пересылаются пользователю по электронной почте.

3. Для чего предназначен демон cron?

cron — классический демон (компьютерная программа в системах класса UNIX), использующийся для периодического выполнения заданий в определённое время. Регулярные действия описываются инструкциями, помещенными в файлы crontab и в специальные каталоги.

4. Как использовать команду crontab?

Crontab - команда, которая используется, для управления планировщиком Cron. Команда crontab создает файл crontab, содержащий команды и инструкции для запуска демона cron.

crontab -e - Редактирование или создание файла расписания для текущего пользователя

crontab -l - Вывод содержимого расписания текущего пользователя

crontab -r - Удаление файла расписания текущего пользователя

crontab -u user Работа с расписаниями конкретных пользователей. Доступно только суперпользователю

Каждая запись в crontab состоит из шести полей, указываемых в следующем порядке:

minute(s) hour(s) day(s) month(s) weekday(s) command(s)

Поля разделяются пробелами или знаками табуляции. Первые пять представляют собой числовые значения, а шестое - это команда, которая будет выполняться.

Примеры использования

Запуск скрипта каждый понедельник в 9:00 и 18:00 часов:

0 9,18 * * 1 /home/ivan/script.sh

5. Что такое сигналы?

Сигналы – это короткие стандартные сообщения, которыми могут обмениваться процессы с помощью системы. Сообщение-сигнал не содержит никакой информации, кроме номера сигнала (для удобства вместо номера можно использовать предопределенное системой имя). Если процессу необходимо реагировать на сигнал особенным образом, он может зарегистрировать обработчик, а если обработчика нет, за него отреагирует система. Как правило, это приводит к немедленному завершению процесса, получившего сигнал. Обработчик сигнала запускается асинхронно, немедленно после получения сигнала, чтобы процесс в это время не делал. Вызов подпрограммы обработки называется перехватом сигнала.

С помощью сигналов можно осуществлять такие акции управления процессами, как приостановка процесса, запуск приостановленного процесса, завершение работы процесса. Всего в Linux существует 63 разных сигнала, их перечень можно посмотреть по команде kill –l.

Сигналы принято обозначать номерами или символическими именами. Все имена сигналов начинаются с приставки SIG, но её иногда опускают: например, сигнал с номером 1 обозначают или как SIGHUP, или просто как HUP.

Можно заставить процесс игнорировать или блокировать некоторые сигналы. Игнорируемый сигнал просто отбрасывается процессом и не оказывает на него никакого влияния. Блокированный сигнал ставится в очередь, но ядро не требует от процесса никаких действий до разблокирования сигнала. После разблокирования сигнала программа его обработки вызывается только один раз, даже если в течение периода блокировки данный сигнал поступал несколько раз.

6. Как с помощью команды kill посылать сигналы процессам?

Передать любой сигнал из командной строки можно любым процессам с помощью команды kill –сигнал PID.

7. Для чего предназначены команды nice и renice?

nice - запускает программу с заданием приоритета.

Приоритет процесса определяется так называемым «значением nice», которое лежит в пределах от +20 (наименьший приоритет, процесс выполняется только тогда, когда ничто другое не занимает процессор), до -20 (наивысший приоритет).

Значение nice устанавливается для каждого процесса в момент порождения этого процесса и при обычном запуске команд или программ принимается равным приоритету родительского процесса. Но существует специальная команда nice, которая позволяет изменять значение nice при запуске программы. 

Формат использования этой программы:

nice [- adnice] command [args]

где adnice – значение (от –20 до +19), добавляемое к значению nice процесса-родителя. Полученная сумма и будет значением nice для запускаемого процесса. Отрицательные adnice значения может устанавливать только суперпользователь. Если опция – adnice не задана, то по умолчанию для процесса-потомка устанавливается значение nice, увеличенное на 10 по сравнению со значением nice родительского процесса.

Команда, renice, служит для изменения значения nice для уже выполняющихся процессов. 

Формат команды:

renice priority [[-p] PID] [[-g] grp] [[-u] user]

Например, команда

renice -1 987 –u daemon –p 32

увеличивает на 1 приоритет процессов с PID 987 и 32, а также всех процессов пользователя daemon.

Суперпользователь может изменить приоритет любого процесса в системе. Другие пользователи могут изменять значение приоритета только для тех процессов, для которых данный пользователь является владельцем. При этом обычный пользователь может только уменьшить значение приоритета (увеличить значение nice), но не может увеличить приоритет, даже для возврата значения nice к значению, устанавливаемому по умолчанию. Поэтому процессы с низким приоритетом не могут породить высокоприоритетных потомков.

8. Как использовать команду ps?

Команда предназначена для получения информации о существующих в операционной системе процессах.

GNU-версия этой программы, входящая в состав Linux, поддерживает опции в стиле трех разных типов UNIX. Опции в стиле Unix98 состоят из одного или нескольких символов, перед которыми должен стоять дефис. Опции в стиле BSD имеют аналогичный вид, только используются без дефиса. Опции, характерные только для GNU-версии представляют собой слово, перед которым должно стоять два дефиса. Их нельзя объединять, как однобуквенные опции двух предшествующих типов.

Таким образом, существует три равноправных формата задания этой команды:

ps [-опции]

ps [опции]

ps [-- длинное_имя_опции [-- длинное_имя_опции] ...]

При этом опции разных типов нельзя употреблять в одной команде.

Первая группа опций регулирует вывод команды. Независимо от наличия опций этой группы команда ps выдает для каждого процесса отдельную строку, но содержимое этой строки может быть разным.
Вторая группа опций определяет, какие процессы включаются в вывод команды. Чтобы получить список всех процессов необходимо использовать команду ps с опциями ax или –A.
Вывод в этих двух случаях отличается только в поле CMD: в первом случае выдается полная командная строка запуска программы, а во втором – только имя запущенной программы.
Описание всех опций программы ps привести невозможно. Поэтому приведем только несколько примеров ее применения, которые покажут, как пользоваться этой командой в типичных ситуациях.

9. Для чего предназначена команда top и как ее использовать?

В отличие от ps команда top отображает состояние процессов и их активность в реальном времени.

Отображается астрономическое время, время, прошедшее с момента запуска системы, число пользователей в системе, число запущенных процессов и число процессов, находящихся в разных состояниях, данные об использовании ЦПУ, памяти и свопа.

Далее отображается таблица, описывающая отдельные процессы. Графы таблицы аналогичны поля вывода команды ps. Содержимое окна обновляется каждые 5 секунд. Список процессов может быть отсортирован по используемому времени ЦПУ (по умолчанию), по использованию памяти, по PID, по времени исполнения. Переключать режимы отображения можно с помощью команд, которые программа top воспринимает.

10. Как использовать команду w?

w - выводит информацию о работающих в данный момент на машине пользователях и об их процессах.

w - [husfV] [user]

Заголовок показывает в следующем порядке: текущее время, сколько времени работает система, сколько пользователей в данный момент работают и среднее время загрузки системы за последние 1, 5 и 15 минут.

Для каждого пользователя выводятся следующие записи:
регистрационное имя, название терминала (tty), удалённая машина, время регистрации в системе, время простоя, JCPU,  PCPU и командную строку его текущего процесса.

Время JCPU - это время, использованное всеми процессами, закреплёнными за tty. Оно не включает завершённые фоновые задания, но включает фоновые задания, выполняющиеся в данный момент.

Время PCPU - это время, использованное текущим процессом, указанным в поле «what» («что»).

Доступные опции

– h – не выводить заголовок;

– u – игнорировать имена пользователей при определении времени текущего процесса и cpu;

– s – использовать короткий формат. Не выводит время регистрации, время JCPU и PCPU;

– f – включить или выключить вывод поля from (имя удалённой машины);

– V – мывести информацию о версии;

user – показать информацию только об указанном пользователе.

Используемые файлы /var/run/utmp информация о пользователях, зарегистриро
ванных в данный момент;

/proc - информация о процессах.
















